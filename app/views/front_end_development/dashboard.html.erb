<%= render 'shared/navbar' %>

<div class="wrapper">
  <div class="container">

    <div class="dashboard-index-grid">
      <div class="user-area">
        <div class="user-image-container">
          <!-- <div class="dashboard-user-image"></div> -->
          <img src="https://images.unsplash.com/photo-1476493279419-b785d41e38d8?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=2500&q=80" class="dashboard-user-image">
        </div>
        <div class="user-info inline">
          <div class="dashboard-user-first-name">
            <h4><%= current_user.first_name %></h4>
          </div>
          <div class="dashboard-user-rating">
            <div class="dashboard-rating-block-container inline">
              <div class="dashboard-rating-block"><strong><%= current_user.rating.round(1) %></strong></div>
            </div>
            <p>Your rating</p>
          </div>
        </div>
        <div class="user-credits">
          <h3><strong><%= current_user.credits %></strong></h3>
          <p>Credits</p>
        </div>
        <div class="user-stats inline">
          <div class="user-items-lent">
            <strong><%= current_user.bookings.count %></strong>
            <p>Items lent</p>
          </div>
          <div class="user-items-borrowed">
            <strong><%= current_user.bookings.count %></strong>
            <p>Items borrowed</p>
          </div>
        </div>
        <div class="buy-more-credits inline">
          <button type="button" class="btn btn-credits btn-green">Buy More Credits</button>
        </div>
      </div>

<!-- TABS -->

      <div class="list-area">
        <div class="tabs">
          <a class="tab active" id="requested" href="#">
            <h3>350</h3>
            <p>Requested</p>
          </a>
          <a class="tab" id="borrowing" href="#">
            <h3>456</h3>
            <p>Borrowing</p>
          </a>
          <a class="tab" id="borrowed" href="#">
            <h3>189</h3>
            <p>Borrowed</p>
          </a>
          <a class="tab" id="my-items" href="#">
            <h3>13</h3>
            <p>My Items</p>
          </a>
        </div>

<!-- REQUESTED -->

        <h2>Requested</h2>
        <% current_user.bookings.where(status: :requested).order(created_at: :desc).each do |booking| %>
          <%= link_to item_path(booking.item) do %>
            <% if booking.response_message_read == false %>
              <div class="green-bar"></div>
            <% end %>
            <div class="booking-card-grid">
              <div class="booking-card-request-info-section">
                <h4><%= "#{booking.item.user.first_name}'s #{booking.item.name}" %></h4>
                <h6><strong><%= "#{booking.start_date} - #{booking.end_date}" %></strong></h6>
              </div>
            <div class="booking-card-request-message-section">
              <div class="request-message inline">
                <strong>Your message:&nbsp;&nbsp;&nbsp;</strong>
                <p><%= booking.request_message %></p>
              </div>
              <div class="response-message inline">
                <strong>Lender's Response:&nbsp;&nbsp;&nbsp;</strong>
                <p><%= booking.response_message %></p>
              </div>
            </div>
            <div class="booking-card-footer-right">
              <div class="read-message-container">
              <% if booking.response_message_read == false %>
                <%= link_to "Read Message", booking_path(booking, response_message_read: true), {class: 'btn btn-green', method: :patch} %>
              <% end %>
                <!-- <button type="button" class="btn btn-primary">Read message</button> -->
              </div>
            </div>
              <div class="booking-card-footer-right">
                <div class="read-message-container">
                <% if booking.response_message_read == false %>
                  <%= link_to "Message Read", booking_path(booking, response_message_read: true), {class: 'btn btn-green', method: :patch} %>
                <% end %>
                  <!-- <button type="button" class="btn btn-primary">Message Read</button> -->
                </div>
                <div class="mark-item-container">
                <%= link_to "Item received", booking_path(booking, status: 'borrowing'), {class: 'btn btn-green', method: :patch} %>
                </div>
              </div>
              <div class="booking-card-image-container">
                <% unless booking.item.user.photo_fake == nil %>
                  <div class="card-avatar avatar-image position-absolute z-index-ten" style="background-image: url(<%= booking.item.user.photo_fake %>)"></div>
                <% else %>
                  <div class="card-avatar position-absolute z-index-ten" style="background-image: url(<%= cl_image_path booking.item.user.photo %>)"></div>
                <% end %>
                  <!-- item photo -->
                <% unless booking.item.photo_fake == nil %>
                  <div class="booking-card-image" style="background-image: url(<%= booking.item.photo_fake %>)"></div>
                <% else %>
                  <div class="booking-card-image" style="background-image: url(<%= cl_image_path booking.item.photo %>)"></div>
                <% end %>
              </div>
              <div class="booking-card-footer">
                <div class="card-rating-box">
                  <h6><i class="fas fa-star"></i><%= booking.item.rating.round(1) %></h6>
                </div>
                <div class="card-credits-box">
                  <h6><%= booking.item.credits %></h6>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>

<!-- BORROWING -->
        <br>
        <br>
        <h2>Borrowing</h2>
        <% current_user.bookings.where(status: :borrowing).order(created_at: :desc).each do |booking| %>
          <%= link_to item_path(booking.item) do %>
          <% if booking.response_message_read == false %>
            <div class="green-bar"></div>
          <% end %>
            <div class="booking-card-grid">
              <div class="booking-card-request-info-section">
                <h4><%= "#{booking.item.user.first_name}'s #{booking.item.name}" %></h4>
                <h6><strong><%= "#{booking.start_date} - #{booking.end_date}" %></strong></h6>
              </div>
              <div class="booking-card-request-message-section">
                <div class="request-message inline">
                  <strong>Your message:&nbsp;&nbsp;&nbsp;</strong>
                  <p><%= booking.request_message %></p>
                </div>
                <div class="response-message inline">
                  <strong>Lender's Response:&nbsp;&nbsp;&nbsp;</strong>
                  <p><%= booking.response_message %></p>
                </div>
              </div>
              <div class="booking-card-footer-right">
                <div class="read-message-container">
                <% if booking.response_message_read == false %>
                  <%= link_to "Message Read", booking_path(booking, response_message_read: true), {class: 'btn btn-green', method: :patch} %>
                <% end %>
                  <!-- <button type="button" class="btn btn-primary">Message Read</button> -->
                </div>
                <div class="mark-item-container">
                <%= link_to "Item received", booking_path(booking, status: 'borrowed'), {class: 'btn btn-green', method: :patch} %>
                </div>
              </div>
              <div class="booking-card-image-container">
                <% unless booking.item.user.photo_fake == nil %>
                  <div class="card-avatar avatar-image position-absolute z-index-ten" style="background-image: url(<%= booking.item.user.photo_fake %>)"></div>
                <% else %>
                  <div class="card-avatar position-absolute z-index-ten" style="background-image: url(<%= cl_image_path booking.item.user.photo %>)"></div>
                <% end %>
                  <!-- item photo -->
                <% unless booking.item.photo_fake == nil %>
                  <div class="booking-card-image" style="background-image: url(<%= booking.item.photo_fake %>)"></div>
                <% else %>
                  <div class="booking-card-image" style="background-image: url(<%= cl_image_path booking.item.photo %>)"></div>
                <% end %>
              </div>
              <div class="booking-card-footer">
                <div class="card-rating-box">
                  <h6><i class="fas fa-star"></i><%= booking.item.rating.round(1) %></h6>
                </div>
                <div class="card-credits-box">
                  <h6><%= booking.item.credits %></h6>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>

<!-- BORROWED -->
        <br>
        <br>
        <h2>Borrowed</h2>
        <% current_user.bookings.where(status: :borrowed).order(created_at: :desc).each do |booking| %>
          <%= link_to item_path(booking.item) do %>
          <% if booking.response_message_read == false %>
            <div class="green-bar"></div>
          <% end %>
          <div class="booking-card-grid">
            <div class="booking-card-request-info-section">
              <h4><%= "#{booking.item.user.first_name}'s #{booking.item.name}" %></h4>
              <h6><strong><%= "#{booking.start_date} - #{booking.end_date}" %></strong></h6>
            </div>
            <div class="booking-card-request-message-section">
              <div class="request-message inline">
                <strong>Your message:&nbsp;&nbsp;&nbsp;</strong>
                <p><%= booking.request_message %></p>
              </div>
              <div class="request-message inline">
                <strong>Lender's Response:&nbsp;&nbsp;&nbsp;</strong>
                <p><%= booking.response_message %></p>
              </div>
            </div>
            <div class="booking-card-footer-right">
              <div class="read-message-container">
              <% if booking.response_message_read == false %>
                <%= link_to "Message Read", booking_path(booking, response_message_read: true), {class: 'btn btn-green', method: :patch} %>
              <% end %>
                <!-- <button type="button" class="btn btn-primary">Message Read</button> -->
              </div>
            </div>
            <div class="booking-card-image-container">
              <% unless booking.item.user.photo_fake == nil %>
                <div class="card-avatar avatar-image position-absolute z-index-ten" style="background-image: url(<%= booking.item.user.photo_fake %>)"></div>
              <% else %>
                <div class="card-avatar position-absolute z-index-ten" style="background-image: url(<%= cl_image_path booking.item.user.photo %>)"></div>
              <% end %>
                <!-- item photo -->
              <% unless booking.item.photo_fake == nil %>
                <div class="booking-card-image" style="background-image: url(<%= booking.item.photo_fake %>)"></div>
              <% else %>
                <div class="booking-card-image" style="background-image: url(<%= cl_image_path booking.item.photo %>)"></div>
              <% end %>
            </div>
            <div class="booking-card-footer">
              <div class="card-rating-box">
                <h6><i class="fas fa-star"></i><%= booking.item.rating.round(1) %></h6>
              </div>
              <div class="card-credits-box">
                <h6><%= booking.item.credits %></h6>
              </div>
            </div>
          </div>
        <% end %>
        <% end %>
      </div>

    </div>
  </div>
</div>
